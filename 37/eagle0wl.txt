x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第○章: Black Hat Japan 2007 レポート ---

著者：eagle0wl

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　新宿・京王プラザホテルで開催された「Black Hat Japan 2007」（以下BHJと略
す）の Briefings に行ってきました。

Black Hat Japan 2007 Briefings
http://www.blackhat.com/html/bh-japan-07/bh-jp-07-jp-index.html

　Wizard Bibleの読者であればBlack Hat（以下BHと略す）の説明は不要だと思い
ますが、レポートの体裁を成すためにあえて説明すると、世界各地で開催されて
いる、情報セキュリティをテーマとしたカンファレンスです。日本での開催は20
04年からで、今回は４年目となります。主催者であるJeff Moss氏はハッカーの祭
典として名高いDEFCONの主催者でもありますが、オフ会的な雰囲気がある（←実
際に行ったことが無いので受け売り）DEFCONとは異なり、BHはプロフェッショナ
ル層を意識しており、厳選された第一線の技術者をスピーカーとして迎えていま
す。技術公演と称した製品アピールを廃したベンダー中立性を掲げていることも
特徴のひとつで、そういったこともあってか、参加費用は若干高めに設定されて
います。

　BHJの参加費用は8万円程度のため、個人で行くには躊躇する金額ですが（それ
でも各国で最も安価ですが）、今回会社の経費にすることができました。BHJ初参
加の私ですが、Wizard Bible読者の皆様にその様子を伝えたいと思い、僭越なが
らレポートを書いてみた次第です。なお、本稿には私の理解が至らないことによ
る間違いがあるかもしれませんが、その辺は大目に見ていただけるとありがたい
です（汗）。


■0x02.) 今回の傾向

　昨年度のBHJは、金床さん曰く（Wizard Bible vol.29参照）、「とにかくウェ
ブアプリケーション」だったとのことですが、今回はマルウェア、（リバースコ
ードエンジニアリングというよりは）コード分析方面が出てきた感があります。


■0x03.) 1日目：会場の雰囲気

　会場は新宿でしたが、近場に住んでいることもあって非常に行きやすかったで
す。昨年のBHJでは、金床さんが遅く到着したがために資料が無くなってしまった
ことを知ってるので、朝早くに到着。受付で事前に発行されたBHロゴ入りe-tick
etを見せて、分厚い冊子と同時通訳受信用のヘッドセット・名札を受け取る。私
の名札には、本名・会社名に加え「eagle0wl」の文字が。ハンドル入り。最初は
ネタになるだろうぐらいしか思っていなかったのですが、実際にできあがった名
札を見て「やってしまった感あり」であることに気付く。しかしながら、初対面
でも知ってくれている人が多く交流しやすかったので、結果としては功を奏した
のかもしれません（汗）。

　早く到着したこともあり、セッションが始まるまでしばし会場近辺をうろつい
ていると、データハウスがブースを出していたことに気づきました。メインは当
然、今回唯一の日本人スピーカーとなる金床さん執筆の「ウェブアプリケーショ
ンセキュリティ」。Wizard Bible増刊号も発行されていましたが、やはり金床特
集号（金床さんが書いた記事の再録）でした。金床さんの発表の後にはサイン会
もありましたが、「クラッキングバイブル」などデータハウス刊のハードカバー
書籍も並んでいました。

　近辺をうろついた後もまだ時間があったので、配布された資料に目を通すこと
にしました。BHJでは2部屋で同時にセッションが行われるため、どちらを見るか
予め吟味する必要があります。「こっちを聴きたい！」という強い意志があれば
いいのですが、迷った場合、私は「（資料をみれば概要はつかめるので）資料以
上の内容の発表が行われそうか」「ありがちなテーマは避ける」を考えて選択し
てみました。しかし、1日目の3コマ目はとても悩みました…（後述）。

　日本人以外のスピーカー（つまり今回だと金床さん以外）は英語で発表を行う
ため、受付でもらったヘッドセットを使えば同時通訳を聴くことができます。こ
のヘッドセットはホテルの備品らしく、片耳だけにかけるタイプのものだったの
ですが（いわゆる耳栓型ではない）、少々大きく私の耳には収まりが悪かったの
で、持参していたiPodのイヤホンを流用しました。座席によっては同時通訳の音
量を大きくしないと、スピーカーからの元声に負ける場合があるので気を付けた
ほうがいいかもしれません。また、同時通訳は行われますが、資料は（日本人ス
ピーカーが作成したものを除き）すべて英語で記載されています。


■0x04.) 1日目：セッション

　最初のセッションは、Kenneth Geers 氏の「101号室からの手紙」を聴こうと思
ったのですが、資料に一通り目を通したところスライドを熟読すれば問題なく概
観は掴めるだろうと予想して、David LaPorte・Eric Kollmann両氏の「DHCPによ
るパッシブなOSフィンガープリンティング」を聴講することにしました。パッシ
ブ（受動的）にOSを特定するツールとしてp.0.fが知られていますが、DHCPでもで
きるぜーという話で、DHCP Optionsの並びに着目するなどしてOSを割り出す方法
を紹介。fingerbank.orgに様々なOSのFingerprintが登録されていることを確認で
きます。

FingerBank
http://www.fingerbank.org/

　なお、前者のセッションについての記事がZDnetで公開されているので、そちら
もご覧頂けたらと思います。

セキュリティ専門家が語る「インターネットの統制状況」
http://japan.zdnet.com/security/story/0,3800079245,20359670,00.htm


　昼食をはさんでの次のセッションは、BHJ2007唯一の日本人スピーカーでありW
B代表（？）でもある金床さんの「DNS PinningとソケットAPIについて」を聴講し
ました。金床さんの名札には「Kanatoko 金床」としか書かれておらず、本名らし
き記載は見当たりませんでした。Wizard Bible vol.29のBHJ2006レポで「次回は、
「金床」の名札での参加にチャレンジしようと思う」と仰っていましたが、見事
に成功したようでお慶び申し上げます（笑）。
　金床さんは、英語の同時通訳の速度を気にしながらゆっくりと喋っていたため、
理解も非常に容易でした。内容については、これまでのWizard Bibleなどで触れ
られている内容を無駄なくまとめたという形なので、技術的な詳細については金
床先生の力作『ウェブアプリケーションセキュリティ』か、Wizard Bibleのバッ
クナンバーをチェックすることをお勧めします。また、金床先生より後日談が掲
載されることを期待していますので、詳細はそちらに譲ることにします。
　終了後は金床さんによるサイン会が開かれ、Wizard Bible増刊号（金床特集号
？）もフリーペーパーとして配布されていました。ところで、今回NHKが取材に来
ていたのですが、その日のうちに放送されたとの事です。YouTubeでそのニュース
映像を確認することができます。

Black Hat Japan 2007 NHK news coverage
http://www.youtube.com/watch?v=CQesc5vNBEo

　BHJがテレビメディアで紹介されたのは今回が初めてのようです。情報セキュリ
ティの重要性が一般に取り上げられたことを喜ばしく思います。

　さて、3つめのセッションですが、一方が Pedram Amini & Aaron Portnoy氏の
「ファジングは最悪だ！（あなたの思うようにファジングするには）」、もう一
方がHalvar Flake氏の「マルウェアの分類とアンパッキングの自動化」なのです
が、どちらを選ぶかとても悩みました。両スピーカー共にリバースエンジニアリ
ング業界では非常に高名で、Pedram Amini氏はリバースエンジニアリングのポー
タルサイトとも言えるOpenRCE.orgの発起人で、Aaron Portnoy氏もOpenRCE.orgに
記事を投稿しています。一方のHalvar Flake氏はドイツに構えるSABRE Security
社の創設者であり、シマンテックの主席研究員であるPeter Szor氏による、コン
ピュータウイルスの歴史・技術・防御策の集大成『The art Of Computer Virus 
Research And Defense』の表紙にも推薦文を寄せており、マルウェア分析のエキ
スパートとして知られています。また、SABRE Securityの研究員であるEro Carr
era氏もBHJ2007のTrainingコース「Windowsのマルウェア検出と分析、リバースエ
ンジニアリング」を担当しており、OpenRCE.orgの常連投稿者でもあります。
　こういった、リバースエンジニアリングという観点で同ジャンルに属する発表
を、同時間帯にスケジュールしたことは正直理解できませんでしたが、両方とも
聴講したかった私としては、次年度以降の改善を強く望む次第です。マジで。結
局今回は、ちょうどマルウェアについて知りたかったこともあり、後者の「マル
ウェアの分類〜」を選択することにしました。

　Halver Flake氏の発表は非常に高度な内容でした（ウイルスについてはそれほ
ど詳しくないので、追いかけ切れていません）。まず80〜90年代のウイルスシー
ンを振り返り、当時のウイルス作成者は主に知的好奇心の赴くままに作成した者
と東西冷戦で暗躍したウイルサーの2通りで、そのほとんどはアセンブリ言語で書
かれ、コードの再利用も行われなかったとのこと。さらに当時は、高級言語でウ
イルスを書くと笑われたものだが、今のウイルスの開発手法は通常のソフトウェ
ア開発に似ており、すでに成熟しているとまで。
　アンチウイルスのシグネチャ（マッチパターン）については、80年代において
は簡単な文字列マッチング程度しか行われていなかったようで、さらにシグネチ
ャ自体のバイト長が短かかったこともあり、わずか1バイトの変更で検出が回避さ
れてしまうという、非常に脆い構造だったそうです。アンチウイルス側がこの変
化に対応するには、亜種への対抗、つまり1シグネチャで亜種も含めて検出できて、
ウイルス作者がゼロから書き直さざるを得ない状態にできればベストということ
でしょう。そこで様々な検出方法を紹介していたのですが、プログラムのフロー
・構造に着目した"Structural Classfication"が非常に興味深かったです。
　商用逆アセンブラ「IDA Pro」のExtensionの形で提供されるSABRE Security社
のBinDiffを用いていました。BinDiffはプログラムの流れ（フロー）をグラフ化
することができるのですが、プログラムの流れ（≒グラフの形状）を比較するこ
とで、プログラムが改変された亜種にも対応することができるという具合です。
ポリモフィック・メタモフィックなウイルスだと、ジャンクコードを挿入するな
どの手法でバイナリが大幅に変化するものですが、プログラムの基本構造自体は
変わらないため、問題なく検出できるということらしいです。
　このBinDiffのデモが行われていましたが、ジャンクコードが入っているためバ
イナリとしては異なるものの、グラフの形状はまったく変わっていないという例
が示されました。これは今回のBHJ2007の中で一番興味を引くものでした。

SABRE BinDiff
http://www.sabre-security.com/products/bindiff.html

　ただ、この方法にも問題はあって、"emulating packers"いわゆる独自の中間言
語と、その中間言語を解釈できる独自の仮想CPUを実装したウイルスに対しては効
果が無いとのこと（注：パッカーだと VMProtectあたりが実装しています）。こ
れはBinDiffが「独自の中間言語」を解釈できないからでしょう。
　ここからは私の解釈ですが、「独自の中間言語と独自の仮想CPU」を実装するこ
とはかなりの労力が必要だと思います。したがって、主流と成るにはまだ時間が
かかるものと思われますが、今後同様のウイルスが立て続けに出てくるかもしれ
ません。その時は、また新しい検出方法が編み出されるのではないかと思ってい
ます。ここまで来ると、一個人が片手間で作るものを超えており、ウイルスシー
ンもここまで来たかという恐怖すら覚えます。このセッションすべてを理解でき
たわけではありませんが（今も復習中）、たくさんの物が得られたと思っていま
す。

OpenRCE.org
http://www.openrce.org/

SABRE Security
http://www.sabre-security.com/

The art Of Computer Virus Research And Defense
http://www.amazon.co.jp/dp/0321304543

Fuzzing
http://www.fuzzing.org/


　1日目最後のセッションは、Billy Hoffman氏の「小さなハイブリッドウェブワ
ームにできること」が、資料を見る限り過激そうな内容だったのですが、もの珍
しさでPaul Sebastian Ziegler氏の「.NETフレームワークでのマルチプラットフ
ォーム型マルウェア「を聞くことにしました。氏は弱冠19歳ながらBHJ2007でスピ
ーカーを勤めた上、レセプションで判明したのですが日本語も堪能でした。彼は
同時通訳を気にしながらゆっくりと喋っていたため、分かりやすい発表でした。
　この発表では、コンセプト実証（PoC：Proof of Concept）の例として、.NETフ
レームワークで実行するワームを作成し、Windows XP -> Linux -> FreeBSD -> 
Windows VistaそしてWindows XPに戻ってくるというデモンストレーションを実践
して見せました。もちろん、.NETワームは万能とは言いがたく、安定性やリバー
スエンジニアリングが容易であったり、現時点におて主流ではありませんが、今
後主流になるかもしれないということで、理解しておかねばと思った次第。


■0x05.) 2日目：レセプション

　すべてのセッションが終了した後はレセプション（要するに懇親会）があった
のですが、私はベタに名刺を交換したりしていましたが、Wizard Bible常連投稿
者であるKenji Aiko氏を発見しました。彼はどうやら、外国人スピーカーが一人
でいる所を見計らって身振り手振りでコミュニケーションを取りたかったらしい
のですが、タイミングを見計らってPaul Sebastian氏に話しかけたところ、日本
語で返され拍子抜けしていたのが笑えました。私も少しだけ話の輪に入って聞い
ていたのですが、日本語が堪能で驚きました。私が気にしていたOpenRCE.orgの中
の人は見かけることができませんでした。残念。
　レセプションが終了後は明日のことも考え、すぐ帰宅しました。しかし突如現
れたチーターマンのせいで、ファミゲーオタの私はテンションが上がってしまい、
全然寝ることができなかったのはここだけの話。

伝説のクソゲー『チーターマン2』が15年ぶりに復活！ ニコニコ動画でブーム
http://news.livedoor.com/article/detail/3359112/

伝説のクソゲー チーターマン2
http://www.nicovideo.jp/watch/sm1289422


■0x06.) 2日目：基調講演

　2日目に主催のJeff Moss氏の開会挨拶に続いて、山口英教授による基調講演が
ありました。あらゆる局面においてITに依存する社会や、最近起こった大規模な
システム障害と品質の問題などを絡めながら概観していましたが、全編を通して
堅いノリではなく実に興味深かったです。
　セキュリティに関してはとかくマネジメントでと言われがちだが、そうではな
くまず技術力での解決を目指すべきだ、それで解決できないならマネジメントや
精度でフォローしていくべきだという趣旨の発言が印象的でした。一方で、Soci
o-Engineeringという概念を取り上げ、社会から切り離された研究や、社会実装で
きない提案は受け入れられないとも。これは、技術自体が単体として優れていて
も、社会に還元できるものでなければ意味がないということだと思いますが、技
術一辺倒で視野狭窄に陥るのではなく、そこから一歩引いて、どう社会に役立て
ることができるのかを考えることがこれからの私たちに求められている、そう感
じました。

「社会状況を意識した技術開発を望む」--Black Hat Japan 基調講演
http://japan.zdnet.com/security/story/0,3800079245,20359767,00.htm

　基調講演後に昼食を済ませて受付近辺をうろついていたら、BHJがスピーカー用
シャツを放出していたので、つい勢いで購入してしまいました。なかなかレアな
品物だと思います（？）。


■0x07.) 2日目：セッション

　2日目1つ目のセッションは、Nathan McFeters・Billy Rios・Rob Carter両氏の
「URIの使用と悪用」も気になってはいたのですが、やはり物珍しさを優先させる
形でNguyen Anh Quynh氏の「バーチャルマシンのハイジャックの可能性」を聴講
することにしました。詳細は復習し切れていないのであまり書きませんが、ブレ
ークポイントの挿入やブレーク後のハンドリングなど、ある程度のデバッグ技術
の理解が求められる内容だったと思います。デモも多く行われ、”1バイトのイン
ジェクション”でキー入力をロギングし、”3バイトのインジェクション”でキー
入力のロギングとコンソール出力を再現するというインパクトのあるものでした。
最後にこのハイジャックを逆手にとり、セキュリティポリシーに反するファイル
操作に対してアラートを上げるデモも行われました。
　それぞれの節目で、「（挿入したバイトを言い当てた人には）ビールを奢りま
す」という問いかけが行われましたが、流石に誰も答えられるわけでもなく。BH
Jの中でもDEFCON色のある発表だったと思います。

　最後のセッションは、Jacob West氏の「スタティック分析によるセキュアプロ
グラミング」を聞くことにしました。
　完成したプログラムに対してどうこうという話ではなく、より品質の良いコー
ドを書くための方法論的な話でしたが、安全なシステムにするには、開発の初期
段階から考慮するべきであるとして、静的なプログラム分析ツールの導入につい
て話していました。しかしながら、分析ツールも万能ではなく"No Silver Bulle
t"（銀の弾などない）ようです。近年のツールは、単にセキュリティ的に問題の
ある箇所を検出するだけではなく、修正の優先順を示すなど様々な機能もあるよ
うですが、それでも完全に検出できるわけではないとも。また、実際に導入する
ときも一気に行うのではなく、ツールの理解を深めながら段階的に行うべきとこ
とだそうです。

「我々は過去の教訓を生かしきれていない」，米Fortify Softwareセキュリティ
担当者
http://itpro.nikkeibp.co.jp/article/NEWS/20071026/285638/

Secure Programming with Static Analysis
http://www.amazon.co.jp/dp/0321424778/

Fortify Software Inc.
http://www.fortifysoftware.com/


■0x08.) 最後に

　BHJ2007は、とても楽しめました。非常に高度かつ密度の高いものばかりだった
ため、当然のことながら私に全てのトピックを理解できるはずもなく、配布資料
を片手にチマチマと復習しているところです。

　しかし、BHJのようなエネルギーを必要とするイベントのレポートはそう簡単に
書けるものではないですね…。いつものノリでいけるだろうと思って書き始めた
ものの、書きながら何度も後悔しました（苦笑）。まあ、所詮この程度というこ
とで。本レポートで少しでもBHJ2007の雰囲気が伝われば幸いです。
